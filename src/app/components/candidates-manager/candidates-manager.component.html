<div class="main-container">
  <header class="app-header">
    <h1>Candidates Management</h1>
  </header>

  <mat-card class="upload-card mat-elevation-z3">
    <mat-card-header>
      <mat-icon mat-card-avatar color="primary">person_add</mat-icon>
      <mat-card-title>Candidate Registration</mat-card-title>
      <mat-card-subtitle>Complete the information and attach the Excel file</mat-card-subtitle>
    </mat-card-header>

    <form [formGroup]="candidateForm" #formDirective="ngForm" (ngSubmit)="save()">
      <mat-card-content>
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Name</mat-label>
            <input matInput formControlName="name" placeholder="Ej. Carlos">
            <mat-icon matSuffix>badge</mat-icon>
            <mat-error *ngIf="candidateForm.get('name')?.invalid">Name is required</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Surname</mat-label>
            <input matInput formControlName="surname" placeholder="Ej. Ruiz">
            <mat-icon matSuffix>badge</mat-icon>
            <mat-error *ngIf="candidateForm.get('surname')?.invalid">Surname is required</mat-error>
          </mat-form-field>

          <div class="file-input-container">
            <input type="file" #fileInput (change)="onFileSelected($event)" style="display: none" accept=".xlsx, .xls">
            <button mat-stroked-button type="button" color="accent" (click)="fileInput.click()" class="file-btn">
              <mat-icon>file_present</mat-icon>
              {{ selectedFile ? selectedFile.name : 'Attach Excel' }}
            </button>
            <mat-error class="custom-error" *ngIf="candidateForm.get('file')?.invalid && candidateForm.get('file')?.touched">
              File is required.
            </mat-error>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions align="end">
        <button mat-flat-button color="primary" type="submit" [disabled]="candidateForm.invalid">
          <mat-icon>save</mat-icon> Process and Save
        </button>
      </mat-card-actions>
    </form>
  </mat-card>

  <mat-divider></mat-divider>

  <div class="table-section">
    <h2 class="section-title">Registered Candidates</h2>
    <table mat-table [dataSource]="candidates" class="mat-elevation-z8 custom-table">
      
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef> Name </th>
        <td mat-cell *matCellDef="let element"> {{element.name}} </td>
      </ng-container>

      <ng-container matColumnDef="surname">
        <th mat-header-cell *matHeaderCellDef> Surname </th>
        <td mat-cell *matCellDef="let element"> {{element.surname}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Actions </th>
        <td mat-cell *matCellDef="let element"> 
          <button mat-icon-button color="primary" (click)="verDetalle(element._id); $event.stopPropagation();">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['name', 'surname', 'actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['name', 'surname', 'actions'];" 
          (click)="verDetalle(row._id)" 
          class="candidate-row">
      </tr>
    </table>
  </div>
</div>